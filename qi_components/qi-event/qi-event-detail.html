<!-- <link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"> add  to top with other imports  -->
<link rel="import" href="../../bower_components/polymer/layout.html"> 

<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">

<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">


<link rel="import" href="../qi-twitter/qi-twitter-panel.html">
<link rel="import" href="../qi-contact/qi-contact-card.html">

<link rel="import" href="../qi-dialog/qi-invite-dialog.html">
<link rel="import" href="../qi-dialog/qi-msg-dialog.html">
<link rel="import" href="../qi-dialog/qi-mtg-dialog.html">



<link rel="import" href="../qi-global/global.html">
<link rel="import" href="qi-event-card.html">
<link rel="import" href="qi-event-detail-match.html">
<link rel="import" href="qi-meeting-card.html">
<link rel="import" href="qi-event-notes-panel.html">

<link rel="import" href="../qi-trait/qi-trait-panel.html">



<dom-module id='qi-event-detail'  > <!-- CONVERTED WIP -->

  <style>
  </style> <!-- TODO Move style tags here from <template> if needed CONVERTED WIP -->

  <template>
  <link rel="stylesheet" href="../quikintro.css" > <!-- TODO Move line about <template>  CONVERTED WIP -->
  <link rel="stylesheet" href="qi-events.css" > <!-- TODO Move line about <template>  CONVERTED WIP -->
  <link rel="stylesheet" href="qi-event-detail.css" > <!-- TODO Move line about <template>  CONVERTED WIP -->
  <link rel="stylesheet" href="../qi-cards.css" > <!-- TODO Move line about <template>  CONVERTED WIP -->
  <link rel="stylesheet" href="../qi-trait/traitlist.css" > <!-- TODO Move line about <template>  CONVERTED WIP -->


  
  <paper-scroll-header-panel id="eventDetailHeaderPanel" fixed="" headerHeight="40" class="flex"> 

  
    <paper-toolbar class="flex">  
    
      <paper-tabs id="scrollableTabs" selected="{{selected}}" scrollable="" role="tablist" hideScrollButton="false" class="flex">  
        <paper-tab role="tab" class="core-selected" >Summary</paper-tab>
        <paper-tab role="tab" >Matches</paper-tab>
        <paper-tab role="tab" >Contacts</paper-tab>
        <paper-tab role="tab" >Meetings</paper-tab>
        <paper-tab role="tab" >Tweets</paper-tab>
        <paper-tab role="tab" >Traits</paper-tab>
        <paper-tab role="tab" >Notes</paper-tab>      
      </paper-tabs>
    
    </paper-toolbar>
    

    <div class="content flex" >   <!-- class="flex"  // TODO cleanup class= if needed  CONVERTED WIP  --> 
    <iron-pages selected="{{selected}}">

      <div id="summary">
        <qi-event-summary event="{{event}}" personas="{{personas}}"></qi-event-summary>
      </div>

      <div id="matches">
        <template is="dom-repeat" items="{{event.matches}}"  as="match">
          <qi-event-detail-match match="{{match}}"></qi-event-detail-match>
        </template>
  
        <qi-invite-dialog id="inviteDialog"></qi-invite-dialog> 
      </div>

      <div id="contacts">
         <template is="dom-repeat" items="{{event.contacts}}" as="contact">
          <qi-contact-card contact="{{contact}}"></qi-contact-card>
        </template> 
        <qi-mtg-dialog id="mtgDialog"></qi-mtg-dialog>
        <qi-msg-dialog id="msgDialog"></qi-msg-dialog>   
      </div>

      <div id="meetings">
        <template is="dom-if" if="{{event.meetings == null || event.meetings.length == 0}}">
          <label>No Meetings Scheduled</label>
        </template>

        <template is="dom-repeat" items="{{event.meetings}}" as="meeting">
          <qi-meeting-card meeting="{{meeting}}"></qi-meeting-card>
        </template>

      </div>


      <div id="twitter">
       <qi-twitter-panel dataUrl="{{event.tweetUrl}}" hashtag="{{event.hashtag}}"></qi-twitter-panel>
      </div>


      <div id="traits">
       <qi-trait-panel event="{{event}}"></qi-trait-panel> 
       
      </div>

      <div id="notes">
       <qi-event-notes-panel notes="{{event.notes}}"></qi-event-notes-panel>
      </div>
    </iron-pages>
    </div>

    

   </template>

   <script>

  Polymer({
      is: 'qi-event-detail', 

      properties:{
        event:{type: Object},
        personas:{type: Array},
        selected: 0,
      }

        eventChanged: function(oldEvent, newEvent){
           this.fire('page-changed', {title: newEvent.title});
        },

        ready: function(){
          this.$.scrollableTabs.selected = 0;
          var inviteDialog = this.$.inviteDialog;

          var mtgsTray = this.$.meetings;

          var corePages = this.$.corePages;

          window.addEventListener('mtg-sent', function(e){
            var mtgCard = new MtgCard2();
            mtgCard.meeting = e.detail.mtg;
            mtgsTray.appendChild(mtgCard);
          });

          window.addEventListener('event-page-selected', function(e){
            corePages.selected = e.detail.index;
          });

          this.addEventListener('openInviteDialog', function(e){
            inviteDialog.contact = e.detail.contact;

            var persona = null;
            var personas = JSON.parse(localStorage.getItem("personas"));

            for(var i=0; i < personas.length; i++){
              if(personas[i].name == this.event.persona){
                persona = personas[i];
                break;
              }
            }
            inviteDialog.persona = persona;

            inviteDialog.open();
          });

          var msgDialog = this.$.msgDialog;
          this.addEventListener("openPingDialog", function(e){
            msgDialog.contact = e.detail.contact;
            msgDialog.open();
          });

          var mtgDialog = this.$.mtgDialog;
          this.addEventListener("openMtgDialog", function(e){
            mtgDialog.contact = e.detail.contact;
            mtgDialog.open();
          });
          
        },

        backHandler: function(){
          this.fire('core-select', {panelTitle:'Event Stream', icon:'arrow-back', clickHandler: function(){}});
        }

    



       
    
      });

   </script>

</dom-module> <!-- CONVERTED -->

<!-- CONVERSION NOTES TODO:
 Review code and look for: 
 - textContent binding from <div>First: {{first}}</div> TO First <span>{{first}}</span><br>
 - polymer-element default attributes such as tabindex="0" move to hostAttributes: {  tabindex: 0}
 - custom elements correct JSON quotes required, change from <my-element foo="{ 'title': 'Persuasion', 'author': 'Austen' }"> to </my-element> to <my-element foo="{ "title": "Persuasion", "author": "Austen" }"></my-element>
 - custom elements attribute use dash-case not camelCase, change from  <my-element fooBar= to <my-element foo-bar
 - Polymer( fix mixins use Behaviors after is: see https://www.polymer-project.org/1.0/docs/devguide/behaviors.html
 - Check layout attributes replaced by layout classes <div layout horizontal center>` to `<div class="layout horizontal center">, 
 - Cleanup class= 
 - Convert core- to iron- or paper- replacement elements at PolymerElements
 - Remove unresolved from <body> tag
 - Cleanup iron-ajax params url for embedded bindings {{}}
 - iron-ajax replace this.$.xxx_ajax.abort(); and this.$.xxx_ajax.go(); with this.$.xxx_ajax.generateRequest() 
 - Fix iron-list if needed 
 - Fix indentation as need 
 - Cleanup Comments to reflect changes ,
 - see https://www.polymer-project.org/1.0/docs/migration.html
   -->