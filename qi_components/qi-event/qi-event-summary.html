<link rel="import" href="../../bower_components/core-field/core-field.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../bower_components/core-input/core-input.html">
<link rel="import" href="../../bower_components/core-item/core-item.html">
<link rel="import" href="../../bower_components/core-dropdown-menu/core-dropdown-menu.html">
<link rel="import" href="../../bower_components/core-dropdown/core-dropdown.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">

<polymer-element name="qi-event-summary" attributes="event">
    <template>


        <core-field>
            <label>{{event.title}}</label>
        </core-field>

        <core-field id="scheduleField" icon="schedule" theme="core-light-theme" center horizontal layout>
            <core-icon icon="schedule" id="core_icon1"></core-icon>
            <core-input id="schedule" flex>{{event.startTime}} - {{event.endTime}}</core-input>
        </core-field>

        <core-field id="notificationField" icon="room" theme="core-light-theme" center horizontal layout>
            <core-icon icon="alarm" id="core_icon3"></core-icon>
            <core-input id="alarm">{{event.notification}}</core-input>
        </core-field>

        <core-field id="hashTagField" icon="room" theme="core-light-theme" center horizontal layout>
            <core-icon-button icon="social:whatshot" id="core_icon4" on-click="{{twitter}}"></core-icon-button>
            <core-input id="twitter" value="{{event.hashtag}}" flex>{{event.hashtag}}</core-input>
        </core-field>

        <core-field id="personaField" icon="room" theme="core-light-theme" center horizontal layout>
            <core-icon icon="perm-identity" id="core_icon5"></core-icon>
            <core-dropdown-menu>
                <core-dropdown class="dropdown">
                    <core-selector selected="{{event.persona}}" valueattr="personaId">
                        <template repeat="{{persona in personas}}">
                            <core-item personaId="{{persona.id}}">{{persona.name}}</core-item>
                        </template>
                    </core-selector>
                </core-dropdown>
            </core-dropdown-menu>
        </core-field>

        <core-field id="locationField" icon="room" theme="core-light-theme" center horizontal layout>
            <core-icon icon="room" id="core_icon2"></core-icon>
            <core-input id="location" flex>{{event.location}}</core-input>
        </core-field>

        <google-map id="map" zoom="14" style="width:250px; height: 250px" libraries="visualization" fitToMarkers >
            <google-map-marker latitude="{{event.coordinates.latitude}}" longitude="{{event.coordinates.longitude}}">
            </google-map-marker>
        </google-map>
    </template>
    <script>
    Polymer('qi-event-summary', {

        domReady: function() {
            
        },

        fixMap: function() {
            var map =  this.$.map; // google map web component
            var gmap = map; // google.maps.Map instance
            var lat = gmap.getCenter().lat();
            var lng = gmap.getCenter().lng();
            var locationLat = this.event.coordinates.latitude;
            var locationLong = this.event.coordinates.longitude;

            var bnds = gmap.getBounds();
            console.log("bnds: " + bnds);

            // at this point, everything is ok
            // before resize latitude 45.63 longitude 16.159999999999968
            console.log('before resize', 'latitude', lat, 'longitude', lng);



            // fix size for core-animated-pages
            //map.resize();

            // at this point latitude and longitude ar wrong
            // after resize latitude 19.16672805677583 longitude 42.878749999999954
            console.log('after resize', 'latitude', gmap.getCenter().lat(), 'longitude', gmap.getCenter().lng());

            // fix center because of resize
            console.log(this.event.coordinates);
            //gmap.setCenter({"latitude":parseFloat(this.event.coordinates.latitude), "longitude":parseFloat(this.event.coordinates.longitude)});
            //gmap.setCenter(new google.maps.LatLng(locationLat, locationLong));

            setTimeout(function() {
                window.dispatchEvent(new Event('resize'));
                map.latitude = locationLat;
                map.longitude = locationLong;
            }, 100);

        }
    });
    </script>
</polymer-element>
