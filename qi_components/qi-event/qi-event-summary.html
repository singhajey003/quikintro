<link rel="import" href="../../bower_components/core-field/core-field.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">
<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../bower_components/core-input/core-input.html">
<link rel="import" href="../../bower_components/core-item/core-item.html">
<link rel="import" href="../../bower_components/core-dropdown-menu/core-dropdown-menu.html">
<link rel="import" href="../../bower_components/core-dropdown/core-dropdown.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">

<polymer-element name="qi-event-summary" attributes="event">
    <template>
    <link rel="stylesheet" href="../quikintro.css" >
    <link rel="stylesheet" href="qi-events.css" >
    <link rel="stylesheet" href="qi-event-summary.css" >

    <div class="font-light venue-bkgnd sanfrancisco" style="background-image:url({{event.background}})">
        <div class="background"></div>

        <div class="eventInfo">
            <p>{{event.title}}</p>
            <p>{{event.startTime}} at {{event.location}}</p>
            <p>{{event.registrantCount}} Registrants</p>
        </div>

        <div class="activitySummary">
            
            <div horizontal layout flex>
                <div id="eventNewMatches">
                  <div id="event1" class="font-light">{{event.matches.length}}</div>
                  <div class="bottomLabel">New<br/>Matches</div>
                </div>

                <div id="eventStats">
                    <div class="eventItem"><span>{{event.contacts.length}}</span> Existing Contacts</div>
                    <div class="eventItem"><span>{{event.numMeetings}}</span> Meetings</div>
                    <div class="eventItem"><span>{{event.numOnsiteMeetings}}</span> On-site Events</div>
                </div>
            </div>
        </div>        
    </div>

    <div class="eventSettings">
        <h4>Event Settings</h4>

          <core-label id="rsvpField" class="settings-row" horizontal justified layout>
           Going?
            <core-dropdown-menu>
                <core-dropdown class="dropdown" halign="right">
                    <core-selector selected="{{event.rsvp}}" valueattr="val">
                       
                            <core-item val="YES">Yes</core-item>
                            <core-item val="NO">No</core-item>
                            <core-item val="MAYBE">Maybe</core-item>
                        
                    </core-selector>
                </core-dropdown>
            </core-dropdown-menu>
         </core-label>


         <core-label id="personaField" class="settings-row" horizontal justified layout center>
           Persona
            <core-dropdown-menu>
                <core-dropdown class="dropdown" halign="right">
                    <core-selector selected="{{event.persona}}" valueattr="personaId">
                        <template repeat="{{persona in personas}}">
                            <core-item personaId="{{persona.name}}">{{persona.name}}</core-item>
                        </template>
                    </core-selector>
                </core-dropdown>
            </core-dropdown-menu>
         </core-label>

         <core-label class="settings-row" horizontal justified layout>
           Alert
            <core-input id="alarm">{{event.notification}}</core-input>
         </core-label>

        <div class="settings-row">
            <google-map id="map" zoom="14" style="width: 100%;" libraries="visualization" fitToMarkers>
                <google-map-marker id="marker">
            </google-map-marker>
            </google-map>
        </div>

    <core-localstorage name="personas" value="{{personas}}"></core-localstorage>



    </div>

    </template>
    <script>
    Polymer('qi-event-summary', {

    	event: null,

        fixMap: function() {
            var map =  this.$.map; // google map web component
            var marker = this.$.marker;
            var gmap = map.map; // google.maps.Map instance
            var lat = gmap.getCenter().lat();
            var lng = gmap.getCenter().lng();
            var locationLat = this.event.coordinates.latitude;
            var locationLong = this.event.coordinates.longitude;

            var bnds = gmap.getBounds();
            //console.log("bnds: " + bnds);

            // at this point, everything is ok
            // before resize latitude 45.63 longitude 16.159999999999968
            //console.log('before resize', 'latitude', lat, 'longitude', lng);



            // fix size for core-animated-pages
            //map.resize();

            // at this point latitude and longitude ar wrong
            // after resize latitude 19.16672805677583 longitude 42.878749999999954
            //console.log('after resize', 'latitude', gmap.getCenter().lat(), 'longitude', gmap.getCenter().lng());

            // fix center because of resize
            //console.log(this.event.coordinates);
            //gmap.setCenter({"latitude":parseFloat(this.event.coordinates.latitude), "longitude":parseFloat(this.event.coordinates.longitude)});
            //gmap.setCenter(new google.maps.LatLng(locationLat, locationLong));

            setTimeout(function() {
                window.dispatchEvent(new Event('resize'));
                map.latitude = locationLat;
                map.longitude = locationLong;
                marker.latitude = locationLat;
                marker.longitude = locationLong;
            }, 100);

        },

        eventChanged: function(oldValue, newValue){
        	this.fixMap();
        }
       
    });
    </script>
</polymer-element>
