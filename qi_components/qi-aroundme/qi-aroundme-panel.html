<!-- <link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"> add  to top with other imports  -->
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">

<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/core-field/core-field.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">

<link rel="import" href="../qi-global/global.html">
<link rel="import" href="../qi-contact/qi-contact-card.html">

<dom-module id='qi-aroundme-panel'  > 

 
  <template>

  <link rel="stylesheet" href="../quikintro.css"> 
  <link rel="stylesheet" href="qi-aroundme-panel.css"> 

  <qi-globals id="globals"></qi-globals>
  
  <template is="dom-bind">
    <iron-ajax auto url="{{$.globals.urls.heatmap}}" response="{{heatmap}}" on-response="ajaxResponse" handle-as="json"></iron-ajax>
  

  <paper-scroll-header-panel headermargin="128" fixed id="eventHeaderPanel" >
   

    <div class="content layout vertical" > 
      
      <div class="maps-panel">
      
        <google-map id="aroundmemap" zoom="11" style="width:275px; height: 360px" libraries="visualization" class="fitToMarkers" > 
          <google-map-marker latitude="37.779" longitude="-122.3892">
          </google-map-marker>
        </google-map>
        
      </div>


      <paper-toolbar fixed>
        <div flex>Contacts</div>  
      </paper-toolbar>
      <template is="dom-repeat" items="{{contacts}}" as="contact">
        <qi-contact-card contact="{{contact}}"></qi-contact-card>
      </template>

    </div>


     </paper-scroll-header-panel>
   </template>

   <script>
  Polymer({
    is: 'qi-aroundme-panel', 


    ajaxResponse: function(event, response) {
        this.heatMap(response.response);
    },

    heatMap: function(data){
        var map = this.$.aroundmemap; // google map web component

        map.addEventListener('api-load', function(e) {
          var gmap = map.map;  // google.maps.Map instance
          var heatmaptype1data=[],heatmaptype2data=[];
          var heatmaptype1, heatmaptype2;

        data.forEach(function(element, index, array){
          
          if(index === 0) {
            element.coordinates.forEach(function(element, index, array){
            //console.log(element + " " + index + " " + array);
              heatmaptype1data[index] = new google.maps.LatLng(element.split(",")[0],element.split(",")[1]);
              if(index === (array.length - 1)) {
                //console.log(heatmaptype1data);
                var pointArray1 = new google.maps.MVCArray(heatmaptype1data);
                heatmaptype1 = new google.maps.visualization.HeatmapLayer({
                  data: pointArray1
                });
                heatmaptype1.setMap(gmap);
              }
            });
          }

          if(index === 1) {
            element.coordinates.forEach(function(element, index, array){
            //console.log(element + " " + index + " " + array);
              heatmaptype2data[index] = new google.maps.LatLng(element.split(",")[0],element.split(",")[1]);
              if(index === (array.length - 1)) {
                //console.log(heatmaptype2data);
                var pointArray2 = new google.maps.MVCArray(heatmaptype2data);
                heatmaptype2 = new google.maps.visualization.HeatmapLayer({
                  data: pointArray2
                });
                heatmaptype2.setMap(gmap);
                var gradient = [
                  'rgba(0, 255, 255, 0)',
                  'rgba(46, 139, 87, 1)'
                ];
                heatmaptype2.set('gradient', heatmaptype2.get('gradient') ? null : gradient);
              }
            });
          }
          
        });


          /*var testData = [
              new google.maps.LatLng(37.782551, -122.445368),
              new google.maps.LatLng(37.782745, -122.444586),
              new google.maps.LatLng(37.782842, -122.443688),
              new google.maps.LatLng(37.782919, -122.442815),
              new google.maps.LatLng(37.782992, -122.442112),
              new google.maps.LatLng(37.783100, -122.441461),
              new google.maps.LatLng(37.783206, -122.440829),
              new google.maps.LatLng(37.783273, -122.440324),
              new google.maps.LatLng(37.783316, -122.440023),
              new google.maps.LatLng(37.783357, -122.439794),
              new google.maps.LatLng(37.783371, -122.439687),
              new google.maps.LatLng(37.783368, -122.439666),
              new google.maps.LatLng(37.783383, -122.439594),
              new google.maps.LatLng(37.783508, -122.439525),
              new google.maps.LatLng(37.783842, -122.439591),
              new google.maps.LatLng(37.784147, -122.439668),
              new google.maps.LatLng(37.784206, -122.439686),
              new google.maps.LatLng(37.784386, -122.439790),
              new google.maps.LatLng(37.784701, -122.439902),
              new google.maps.LatLng(37.784965, -122.439938),
              new google.maps.LatLng(37.785010, -122.439947),
              new google.maps.LatLng(37.785360, -122.439952),
              new google.maps.LatLng(37.785715, -122.440030),
              new google.maps.LatLng(37.786117, -122.440119),
              new google.maps.LatLng(37.786564, -122.440209),
              new google.maps.LatLng(37.786905, -122.440270),
              new google.maps.LatLng(37.786956, -122.440279),
              new google.maps.LatLng(37.800224, -122.433520),
              new google.maps.LatLng(37.800155, -122.434101),
              new google.maps.LatLng(37.800160, -122.434430),
              new google.maps.LatLng(37.800378, -122.434527),
              new google.maps.LatLng(37.800738, -122.434598),
              new google.maps.LatLng(37.800938, -122.434650),
              new google.maps.LatLng(37.801024, -122.434889),
              new google.maps.LatLng(37.800955, -122.435392),
              new google.maps.LatLng(37.800886, -122.435959),
              new google.maps.LatLng(37.800811, -122.436275),
              new google.maps.LatLng(37.800788, -122.436299),
              new google.maps.LatLng(37.800719, -122.436302),
              new google.maps.LatLng(37.800702, -122.436298),
              new google.maps.LatLng(37.800661, -122.436273),
              new google.maps.LatLng(37.800395, -122.436172),
              new google.maps.LatLng(37.800228, -122.436116),
              new google.maps.LatLng(37.800169, -122.436130),
              new google.maps.LatLng(37.800066, -122.436167),
              new google.maps.LatLng(37.784345, -122.422922),
              new google.maps.LatLng(37.784389, -122.422926),
              new google.maps.LatLng(37.784437, -122.422924),
              new google.maps.LatLng(37.784746, -122.422818),
              new google.maps.LatLng(37.785436, -122.422959),
              new google.maps.LatLng(37.786120, -122.423112),
              new google.maps.LatLng(37.786433, -122.423029),
              new google.maps.LatLng(37.786631, -122.421213),
              new google.maps.LatLng(37.786660, -122.421033),
              new google.maps.LatLng(37.786801, -122.420141),
              new google.maps.LatLng(37.786823, -122.420034),
              new google.maps.LatLng(37.786831, -122.419916),
              new google.maps.LatLng(37.787034, -122.418208),
              new google.maps.LatLng(37.787056, -122.418034)
            ];

          var testData1 = [
              new google.maps.LatLng(37.781201,-122.488461),
              new google.maps.LatLng(37.781472,-122.486057),
              new google.maps.LatLng(37.781065,-122.491035),
              new google.maps.LatLng(37.780251,-122.490692),
              new google.maps.LatLng(37.778623,-122.489662),
              new google.maps.LatLng(37.780251,-122.487946),
              new google.maps.LatLng(37.780793,-122.487087),
              new google.maps.LatLng(37.780386,-122.484341),
              new google.maps.LatLng(37.778894,-122.485542),
              new google.maps.LatLng(37.778894,-122.488117),
              new google.maps.LatLng(37.779301,-122.486744),
              new google.maps.LatLng(37.778894,-122.486916)
            ];


          var pointArray = new google.maps.MVCArray(testData);
          var pointArray1 = new google.maps.MVCArray(testData1);

          //console.log(pointArray);

          heatmap = new google.maps.visualization.HeatmapLayer({
            data: pointArray
          });

          heatmap1 = new google.maps.visualization.HeatmapLayer({
            data: pointArray1
          });

          //console.log(heatmap);

          heatmap.setMap(gmap);
          heatmap1.setMap(gmap);

          var gradient = [
            'rgba(0, 255, 255, 0)',
            'rgba(46, 139, 87, 1)'
          ];
          
          heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);*/

        });
        
          
    }
  
    
  });

   </script>

</dom-module> <!-- CONVERTED -->

<!-- CONVERSION NOTES TODO:
 Review code and look for: 
 - textContent binding from <div>First: {{first}}</div> TO First <span>{{first}}</span><br>
 - polymer-element default attributes such as tabindex="0" move to hostAttributes: {  tabindex: 0}
 - custom elements correct JSON quotes required, change from <my-element foo="{ 'title': 'Persuasion', 'author': 'Austen' }"> to </my-element> to <my-element foo="{ "title": "Persuasion", "author": "Austen" }"></my-element>
 - custom elements attribute use dash-case not camelCase, change from  <my-element fooBar= to <my-element foo-bar
 - Polymer( fix mixins use Behaviors after is: see https://www.polymer-project.org/1.0/docs/devguide/behaviors.html
 - Check layout attributes replaced by layout classes <div layout horizontal center>` to `<div class="layout horizontal center">, 
 - Cleanup class= 
 - Convert core- to iron- or paper- replacement elements at PolymerElements
 - Remove unresolved from <body> tag
 - Cleanup iron-ajax params url for embedded bindings {{}}
 - iron-ajax replace this.$.xxx_ajax.abort(); and this.$.xxx_ajax.go(); with this.$.xxx_ajax.generateRequest() 
 - Fix iron-list if needed 
 - Fix indentation as need 
 - Cleanup Comments to reflect changes ,
 - see https://www.polymer-project.org/1.0/docs/migration.html
   -->