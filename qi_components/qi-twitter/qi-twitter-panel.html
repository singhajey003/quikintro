<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html"> 
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">

<link rel="import" href="../qi-dialog/qi-twitter-dialog.html">

<link rel="import" href="qi-twitter-card.html">
<dom-module id='qi-twitter-panel'  >

	<style>
	
	.label{
		font-size: 9pt;
		font-weight: bold;
		margin-right: 5px;
		color: #6c6c6c;
	}
	.value{
		font-size: 9pt;
		color: #5C9AA9;
	}
	</style>

 
	<template>

	<iron-ajax id="ajax"
	auto
	  url="{{dataUrl}}"
	  handleAs="json"
	  on-response="handleResponse" last-response="{{response}}"></iron-ajax>

	<paper-header-panel class="flex fit"> 

	 
		<div class="hashtagBanner layout horizontal">
			<div class="label">Event Hashtag:</div> 
			<div on-click="activate" class="value">[[hashtag]]</div>
		</div> 
	 

	  <div class="content layout vertical flex fit"  >  
		  <div id="streamTray" style="overflow: auto">
			 
		  </div>

		  <!--

		   <template is="dom-repeat" items="{{response.statuses}}"  as="tweet">
			  	<qi-twitter-card tweet="{{tweet}}"></qi-twitter-card>
			  </template>

		  <div style="min-height: 60px; background-color: rgba(0,0,0,0.0)" fixed >
		  	 
		  </div>

		  -->

		 <qi-twitter-dialog id="twitterDialog" hashtag="[[hashtag]]"></qi-twitter-dialog>
		 
	</div>
	<paper-fab icon="create" mini on-click="openDialog"></paper-fab> 
	</paper-header-panel>

	</template>


	<script>
		Polymer({
    		is: 'qi-twitter-panel', 

    		properties:{
    			dataUrl: {type: String, value:'', notify: true, observer: 'dataUrlChanged'},
    			hashtag: {type: String},
    			response: {type: Object, notify: true, observer: 'responseChanged'}
    		},

    		dataUrlChanged: function(newUrl, oldUrl){
    			if(newUrl != null && newUrl != ''){
    				activate();
    			}
    		},

    		responseChanged:function(newResponse, oldResponse){
    			
    		},

    		handleResponse: function(e){
    			var streamTray = this.$.streamTray;
    			var newResponse = e.detail.response;
    			if(newResponse != null){
					var values = newResponse.statuses;
					for(var i=0; i < values.length; i++ ){
						var childNode = new TwitterCard();
						childNode.tweet = values[i];
						streamTray.addChildNode(childNode);
					}
    			}
	    	},

			ready: function(){
				this.addEventListener('openTweetDialog', function(){
					this.$.twitterDialog.open();
				});
				
			},

			openDialog: function(){
				this.$.twitterDialog.open();
			},

			activate: function(){
				this.ajax.url = this.dataUrl;
				this.ajax.generateRequest();
			}
		
		});

	</script>

</dom-module> 