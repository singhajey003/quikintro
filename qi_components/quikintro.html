<link rel="import" href="../bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-menu/core-menu.html">
<link rel="import" href="../bower_components/core-item/core-item.html">
<link rel="import" href="../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/core-icons/maps-icons.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-menu/core-submenu.html">
<link rel="import" href="../bower_components/core-pages/core-pages.html">
<link rel="import" href="../bower_components/core-localstorage/core-localstorage.html">

<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-scroll-header-panel/core-scroll-header-panel.html">

<link rel="import" href="qi-event/qi-event-panel.html">
<link rel="import" href="qi-aroundme/qi-aroundme-panel.html">
<link rel="import" href="qi-profile/qi-profile-panel.html">
<link rel="import" href="qi-contact/qi-contact-panel.html">
<link rel="import" href="qi-persona/qi-persona-panel.html">
<link rel="import" href="qi-msg/qi-msg-panel.html">
<link rel="import" href="qi-onboard/qi-onboard-panel.html">
<link rel="import" href="qi-event/qi-event-detail.html">
<link rel="import" href="qi-splash/qi-splash.html">
<link rel="import" href="qi-event/qi-event-stream.html">
<link rel="import" href="qi-security/qi-security-panel.html">
<link rel="import" href="qi-scaffold/qi-scaffold.html">
<link rel="import" href="qi-home/qi-home.html">

<link rel="import" href="qi-custom-icons/qi-custom-svg-icons.html">


<polymer-element name="quik-intro">

  <template>
    <link rel="stylesheet" href="quikintro.css" >

    <!-- Data Loading -->
    <qi-globals id="globals"></qi-globals>    
    <core-ajax auto url="{{$.globals.urls.getPersonas}}" response="{{personaList}}" handleAs="json"></core-ajax>
    <core-ajax auto url="{{$.globals.urls.events}}" response="{{eventList}}" handleAs="json"></core-ajax>
    <core-ajax auto url="{{$.globals.urls.contacts}}" response="{{contactList}}" handleAs="json"></core-ajax>
    <core-ajax auto url="{{$.globals.urls.profile}}" response="{{currProfile}}" handleAs="json"></core-ajax>

     <core-ajax auto url="{{$.globals.urls.messages}}" response="{{msgs}}" handleAs="json"></core-ajax>

    <core-localstorage name="msgs" value="{{msgs}}"></core-localstorage>
    <core-localstorage name="personas" value="{{personaList}}"></core-localstorage>
    <core-localstorage name="contacts" value="{{contactList}}"></core-localstorage>
    <core-localstorage name="profile" value="{{currProfile}}"></core-localstorage>
 
    <!-- UI -->
    <qi-scaffold id="coreScaffold" responsiveWidth="480px" force-narrow>

      <core-header-panel mode="seamed" id="core_header_panel" navigation flex>
        <core-toolbar id="core_toolbar" horizontal end-justified layout>


        </core-toolbar>
        <core-menu  id="menu" theme="core-light-theme" >

          <core-menu selected="{{page}}" valueattr="pageId" >
            <core-item id="home" icon="home" pageId="home">Home</core-item>
            <core-item id="events" icon="event"  pageId="events">Events</core-item>
            <core-item id="aroundme" icon="maps:my-location" pageId="aroundme">Around Me</core-item>
            <core-item id="messages" icon="communication:forum"  pageId="messages">Messages</core-item>
            <core-item id="contact" icon="face" pageId="contacts">Contacts</core-item>
          </core-menu>

          <core-submenu selected="{{page}}" valueattr="pageId" icon="settings" label="Settings">
              <core-item id="securityItem" pageId="security"> Security</core-item>
              <core-item id="onboardItem" pageId="onboard"> Accounts</core-item>
              <core-item id="profileItem" pageId="profile"> Profile</core-item>
              <core-item id="personaItem" pageId="personas">Personas</core-item>
          </core-submenu>
        </core-menu>
        
      </core-header-panel>

      <div id="title" tool horizontal layout center flex>
        <div flex>{{panelTitle}}</div>

        <div><qi-toggle openIcon="social:person" closedIcon="social:person-outline"></qi-toggle></div>
      </div>
      
      <div class="content">
      <core-pages id="pages" selected="{{page}}" valueattr="pageId" notap fullbleed fit >
        
        <section id="Login" pageId="login" selected>

            <qi-splash id="splashPanel"></qi-splash>

        </section>

        <section id="Home" pageId="home">
          <qi-home></qi-home>
        </section>

        <section id="Security" pageId="security">
          <qi-security-panel></qi-security-panel>
        </section>
        <section id="On Boarding" pageId="onboard">
          <qi-onboard-panel></qi-onboard-panel>
        </section>
        <section id="Profile" pageId="profile">
          <qi-profile-panel id="profilePanel" profile="{{currProfile}}"></qi-profile-panel>
        </section>
        
        <section id="Personas" pageId="personas">
          <qi-persona-panel id="personaPanel" ></qi-persona-panel>
        </section>
        <section id="Event Stream" pageId="events" >
          <qi-event-stream id="eventStream" events="{{eventList}}" personas="{{personas}}"></qi-event-stream>
        </section>
        <section id="Around Me" pageId="aroundme" >
          <qi-aroundme-panel id="aroundMe" ></qi-aroundme-panel>
        </section>
        <section id="Messages" pageId="messages">
          <qi-msg-panel ></qi-msg-panel>
        </section>
        <section id="Contacts" pageId="contacts">
          <qi-contact-panel id="contactPanel" contacts="{{contactList}}"></qi-contact-panel>
        </section>
      </core-pages>
      </div>
    </qi-scaffold>
  </template>

  <script>

    Polymer('quik-intro',{
      page: 0,
      panelTitle: 'QuikIntro',
      eventList: [],
      contactList: [],
      personaList: [],
      contactList: [],
      currProfile: null,

      contactListChanged: function(oldValue, newValue){
        var contactPanel = this.$.contactPanel;
        contactPanel.contacts = newValue;

        var aroundMe = this.$.aroundMe;
        aroundMe.contacts = newValue;
      },

      currProfileChanged: function(oldValue, newValue){
        var profilePanel = this.$.profilePanel;
        profilePanel.profile = newValue;
      },

      eventListChanged: function(oldValue, newValue){
        var eventPanel = this.$.eventStream;
        eventPanel.events = newValue;
      },
      
      pageChanged: function(oldValue, newValue){
        this.$.coreScaffold.closeDrawer();
      },


      ready: function(){

        this.$.pages.addEventListener("login", function(e){

          //TODO add login code here.

          // after login is complete, segue to the home page
          e.currentTarget.selected = 1;
        });

        var panelTitle = this.panelTitle;

        this.addEventListener('page-changed', function(e){

          var nuTitle = e.detail.title;
          if(nuTitle.length > 10) {
            nuTitle = nuTitle.substring(0, 10);
            nuTitle += "...";
          }
          this.panelTitle = nuTitle;
        });


        this.$.pages.addEventListener("core-select", function(e){
          
          var qi = document.querySelector('quik-intro');
          var scaffolding = qi.$.coreScaffold;
          var menuButton = scaffolding.getMenuButton();

          if(e.detail.item.id == 'Event Stream'){
            var qiEventStream = e.detail.item.firstElementChild;
            qiEventStream.selectedEventPage = 0;
          }

          // if the event originated from a top-level
          // page change event
          if(e.srcElement.id == 'pages'){
            var id = e.detail.item.id;
            if(id != null &&  id != ""){
              
              var conf = qi.conf[id];
          
              // set the title
              qi.panelTitle = conf.panelTitle;

              // set the menu button icon
              
              menuButton.icon = conf.icon;

              // set the click handler for the button
              scaffolding.handleClick = conf.clickHandler;
            }
          }else {
           
          //otherwise the event came from some sub-level page
          // qi.panelTitle = e.panelTitle;
          // menuButton.icon = e.icon;
          // scaffolding.handleClick = e.clickHandler;
          }
        });
      },

      handleToggle: function(){
        this.$.coreScaffold.openDrawer();
      },

     

      conf:{

        "Login":{
          panelTitle: 'QuikIntro',
          icon: 'qi:logo',
          clickHandler: function(e){ 
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }
        },

        "Home":{
          panelTitle:'Home',
          icon: 'qi:logo',
          clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }
        },
        "Security":{
          panelTitle:'Security',
          icon: 'qi:logo',
          clickHandler: function(){
            var qi = document.querySelector("quik-intro");
            qi.$.coreScaffold.openDrawer();
          }
        },
        "Personas":{
          panelTitle: 'Personas',
          icon: 'qi:logo',
         clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }
        },
        "On Boarding":{
          panelTitle: 'On Boarding',
          icon: 'qi:logo',
         clickHandler: function(){
            var qi = document.querySelector("quik-intro");
            qi.$.pages.selected = 1;
          }
        },
        "Profile":{
          panelTitle: 'Profile',
          icon: 'qi:logo',
         clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }
        },
        "Event Stream":{
          panelTitle: 'Events',
          icon: 'qi:logo',
          clickHandler: function(e){
           
            var qi = document.querySelector("quik-intro");

            var selectedEventPage = qi.$.pages.querySelector('qi-event-stream').selectedEventPage;
            if(selectedEventPage == 0)
              qi.$.pages.selected = 1;
            else if (selectedEventPage == 1){
              qi.$.pages.querySelector('qi-event-stream').selectedEventPage = 0;
              qi.$.pages.selected = 6;
            }

            this.fire('core-select',{src:'Event Stream'})
          }
        },

        "Around Me":{
          panelTitle: 'Around Me',
          icon: 'qi:logo',
          clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }        },
        "Messages":{
          panelTitle: 'Messages',
          icon: 'qi:logo',
        clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }      
        },


        "Contacts":{
          panelTitle:'Contacts',
          icon:'qi:logo',
          clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }       
        }

       
      }
      

    });

  </script>

</polymer-element>