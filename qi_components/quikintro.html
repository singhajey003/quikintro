<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../bower_components/iron-icons/social-icons.html">

<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-localstorage/iron-localstorage.html">

<link rel="import" href="../bower_components/paper-toast/paper-toast.html">

<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">

<link rel="import" href="qi-event/qi-event-panel.html">
<link rel="import" href="qi-aroundme/qi-aroundme-panel.html">
<link rel="import" href="qi-profile/qi-profile-panel.html">
<link rel="import" href="qi-contact/qi-contact-panel.html">
<link rel="import" href="qi-persona/qi-persona-panel.html">
<link rel="import" href="qi-msg/qi-msg-panel.html">
<link rel="import" href="qi-onboard/qi-onboard-panel.html">
<link rel="import" href="qi-event/qi-event-detail.html">
<link rel="import" href="qi-splash/qi-splash.html">
<link rel="import" href="qi-event/qi-event-stream.html">
<link rel="import" href="qi-security/qi-security-panel.html">
<link rel="import" href="qi-scaffold/qi-scaffold.html">
<link rel="import" href="qi-home/qi-home.html">

<link rel="import" href="qi-theme.html">

<dom-module id='quik-intro'  > 

  <style>
    qi-toggle.anonToggle{
      color: white;
    }

  </style>

  <template>
    <link rel="stylesheet" href="quikintro.css" > 
    <!-- Data Loading -->
    <qi-globals id="globals"></qi-globals>    
    <iron-ajax auto url="{{this.$.globals.urls.getPersonas}}" response="{{personaList}}" handle-as="json"></iron-ajax>
    <iron-ajax auto url="{{this.$.globals.urls.events}}" response="{{eventList}}" handle-as="json"></iron-ajax>
     <iron-ajax auto url="{{this.$.globals.urls.contacts}}" response="{{contactList}}" handle-as="json"></iron-ajax>
    <iron-ajax auto url="{{this.$.globals.urls.profile}}" response="{{currProfile}}" handle-as="json"></iron-ajax>

     <iron-ajax auto url="{{this.$.globals.urls.messages}}" response="{{msgs}}" handle-as="json"></iron-ajax>

    <iron-localstorage name="msgs" value="{{msgs}}"></iron-localstorage>
    <iron-localstorage name="personas" value="{{personaList}}"></iron-localstorage>
    <iron-localstorage name="contacts" value="{{contactList}}"></iron-localstorage>
    <iron-localstorage name="profile" value="{{currProfile}}"></iron-localstorage>
 
    <!-- UI -->
    <qi-scaffold id="coreScaffold" responsiveWidth="480px" force-narrow>

      <paper-header-panel mode="seamed" id="core_header_panel" navigation class="flex">  
        <paper-toolbar id="core_toolbar" class="horizontal end-justified layout"> 


        </paper-toolbar>
        <paper-menu  id="menu" >

          <paper-menu selected="{{page}}" valueattr="pageId" >
            <paper-item id="home" icon="home" pageId="home">Home</paper-item>
            <paper-item id="events" icon="event"  pageId="events">Events</paper-item>
            <paper-item id="aroundme" icon="maps:my-location" pageId="aroundme">Around Me</paper-item>
            <paper-item id="messages" icon="communication:forum"  pageId="messages">Messages</paper-item>
            <paper-item id="contact" icon="face" pageId="contacts">Contacts</paper-item>
          </paper-menu>

          <paper-menu selected="{{page}}" valueattr="pageId" icon="settings" label="Settings">
              <paper-item id="securityItem" pageId="security"> Security</paper-item>
              <paper-item id="onboardItem" pageId="onboard"> Accounts</paper-item>
              <paper-item id="profileItem" pageId="profile"> Profile</paper-item>
              <paper-item id="personaItem" pageId="personas">Personas</paper-item>
          </paper-menu>
        </paper-menu>
        
      </paper-header-panel>

      <div id="title" tool class="horizontal layout center flex"> 
        <div class="flex">{{panelTitle}}</div> 
        <div><qi-toggle class="anonToggle" openIcon="social:person" closedIcon="social:person-outline"></qi-toggle></div>
      </div>
      
      <div class="content">
      <iron-pages id="pages" selected="{{page}}" valueattr="pageId" notap fullbleed class="fit flex" > 
        <section id="Login" pageId="login" selected>
            <qi-splash id="splashPanel"></qi-splash>
        </section>

        <section id="Home" pageId="home">
          <qi-home></qi-home>
        </section>

        <section id="Security" pageId="security">
          <qi-security-panel></qi-security-panel>
        </section>
        <section id="On Boarding" pageId="onboard">
          <qi-onboard-panel></qi-onboard-panel>
        </section>
        <section id="Profile" pageId="profile">
          <qi-profile-panel id="profilePanel" profile="{{currProfile}}"></qi-profile-panel>
        </section>
        
        <section id="Personas" pageId="personas">
          <qi-persona-panel id="personaPanel" ></qi-persona-panel>
        </section>
        <section id="Event Stream" pageId="events" >
          <qi-event-stream id="eventStream" events="{{eventList}}" personas="{{personas}}"></qi-event-stream>
        </section>
        <section id="Around Me" pageId="aroundme" >
          <qi-aroundme-panel id="aroundMe" ></qi-aroundme-panel>
        </section>
        <section id="Messages" pageId="messages">
          <qi-msg-panel ></qi-msg-panel>
        </section>
        <section id="Contacts" pageId="contacts">
          <qi-contact-panel id="contactPanel" contacts="{{contactList}}"></qi-contact-panel>
        </section>
      </iron-pages>
      </div>
    </qi-scaffold>
    <paper-toast id="toast"></paper-toast>
  </template>

  <script>

    Polymer({
      is: 'quik-intro', 

      properties:{
        page:{type: Number,  value:0, notify: true, observer: 'pageChanged'},
        panelTitle: {type: String, value: 'QuikIntro'},
        eventList: {type: Array, value:[], notify: true, observer:'eventListChanged'},
        contactList: {type: Array, value: [], notify: true, observer:'contactListChanged'},
        personaList: {type: Array, value: []},
        contactList: {type: Array, value: [], notify: true, observer:'contactListChanged'},
        currProfile: {type: Object, value: null, notify: true, observer: 'currProfileChanged'}
      },

      contactListChanged: function(oldValue, newValue){
        var contactPanel = this.$.contactPanel;
        contactPanel.contacts = newValue;

        var aroundMe = this.$.aroundMe;
        aroundMe.contacts = newValue;
      },

      currProfileChanged: function(oldValue, newValue){
        var profilePanel = this.$.profilePanel;
        profilePanel.profile = newValue;
      },

      eventListChanged: function(oldValue, newValue){
        var eventPanel = this.$.eventStream;
        eventPanel.events = newValue;
      },
      
      pageChanged: function(oldValue, newValue){
        this.$.coreScaffold.closeDrawer();
      },


      ready: function(){

        this.$.pages.addEventListener("login", function(e){

          //TODO add login code here.

          // after login is complete, segue to the home page
          e.currentTarget.selected = 6;
        });

        var panelTitle = this.panelTitle;

        this.addEventListener('page-changed', function(e){

          var nuTitle = e.detail.title;
          if(nuTitle.length > 10) {
            nuTitle = nuTitle.substring(0, 10);
            nuTitle += "...";
          }
          this.panelTitle = nuTitle;
        });


        var toast = this.$.toast;
        this.addEventListener('msg-sent', function(e){
          toast.text = "Message sent";
          toast.show();
        });

        this.addEventListener('invite-sent', function(e){
          toast.text = "Invitation sent";
          toast.show();
        });

        this.addEventListener('mtg-sent', function(e){
          toast.text = "Meeting request sent";
          toast.show();
        });


        this.$.pages.addEventListener("core-select", function(e){
          
          var qi = document.querySelector('quik-intro');
          var scaffolding = qi.$.coreScaffold;
          var menuButton = scaffolding.getMenuButton();

          if(e.detail.item.id == 'Event Stream'){
            var qiEventStream = e.detail.item.firstElementChild;
            qiEventStream.selectedEventPage = 0;
          }

          // if the event originated from a top-level
          // page change event
          if(e.srcElement.id == 'pages'){
            var id = e.detail.item.id;
            if(id != null &&  id != ""){
              
              var conf = qi.conf[id];
          
              // set the title
              qi.panelTitle = conf.panelTitle;

              // set the menu button icon
              
              menuButton.icon = conf.icon;

              // set the click handler for the button
              scaffolding.handleClick = conf.clickHandler;
            }
          }else {
           
          //otherwise the event came from some sub-level page
          // qi.panelTitle = e.panelTitle;
          // menuButton.icon = e.icon;
          // scaffolding.handleClick = e.clickHandler;
          }
        });
      },

      handleToggle: function(){
        this.$.coreScaffold.openDrawer();
      },

     

      conf:{

        "Login":{
          panelTitle: 'QuikIntro',
          icon: 'qi:logo',
          clickHandler: function(e){ 
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }
        },

        "Home":{
          panelTitle:'Home',
          icon: 'qi:logo',
          clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }
        },
        "Security":{
          panelTitle:'Security',
          icon: 'qi:logo',
          clickHandler: function(){
            var qi = document.querySelector("quik-intro");
            qi.$.coreScaffold.openDrawer();
          }
        },
        "Personas":{
          panelTitle: 'Personas',
          icon: 'qi:logo',
         clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }
        },
        "On Boarding":{
          panelTitle: 'On Boarding',
          icon: 'qi:logo',
         clickHandler: function(){
            var qi = document.querySelector("quik-intro");
            qi.$.pages.selected = 1;
          }
        },
        "Profile":{
          panelTitle: 'Profile',
          icon: 'qi:logo',
         clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }
        },
        "Event Stream":{
          panelTitle: 'Events',
          icon: 'qi:logo',
          clickHandler: function(e){
           
            var qi = document.querySelector("quik-intro");

            var selectedEventPage = qi.$.pages.querySelector('qi-event-stream').selectedEventPage;
            if(selectedEventPage == 0)
              qi.$.pages.selected = 1;
            else if (selectedEventPage == 1){
              qi.$.pages.querySelector('qi-event-stream').selectedEventPage = 0;
              qi.$.pages.selected = 6;
            }

            this.fire('core-select',{src:'Event Stream'})
          }
        },

        "Around Me":{
          panelTitle: 'Around Me',
          icon: 'qi:logo',
          clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }        },
        "Messages":{
          panelTitle: 'Messages',
          icon: 'qi:logo',
        clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }      
        },


        "Contacts":{
          panelTitle:'Contacts',
          icon:'qi:logo',
          clickHandler: function(){
            var qi = document.querySelector('quik-intro');
            qi.$.coreScaffold.openDrawer();
          }       
        }

       
      }
      

    });

  </script>

</dom-module> <!-- CONVERTED -->

<!-- CONVERSION NOTES TODO:
 Review code and look for: 
 - textContent binding from <div>First: {{first}}</div> TO First <span>{{first}}</span><br>
 - polymer-element default attributes such as tabindex="0" move to hostAttributes: {  tabindex: 0}
 - custom elements correct JSON quotes required, change from <my-element foo="{ 'title': 'Persuasion', 'author': 'Austen' }"> to </my-element> to <my-element foo="{ "title": "Persuasion", "author": "Austen" }"></my-element>
 - custom elements attribute use dash-case not camelCase, change from  <my-element fooBar= to <my-element foo-bar
 - Polymer( fix mixins use Behaviors after is: see https://www.polymer-project.org/1.0/docs/devguide/behaviors.html
 - Check layout attributes replaced by layout classes <div layout horizontal center>` to `<div class="layout horizontal center">, 
 - Cleanup class= 
 - Convert core- to iron- or paper- replacement elements at PolymerElements
 - Remove unresolved from <body> tag
 - Cleanup iron-ajax params url for embedded bindings {{}}
 - iron-ajax replace this.$.xxx_ajax.abort(); and this.$.xxx_ajax.go(); with this.$.xxx_ajax.generateRequest() 
 - Fix iron-list if needed 
 - Fix indentation as need 
 - Cleanup Comments to reflect changes ,
 - see https://www.polymer-project.org/1.0/docs/migration.html
   -->